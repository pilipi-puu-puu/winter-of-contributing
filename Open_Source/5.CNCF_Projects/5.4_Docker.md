# **Everything about Docker**

<br><img src='https://user-images.githubusercontent.com/69195262/134471311-a85d122a-b233-49f4-97ba-3bf948274d84.png' style='width:30%'><br>
Docker has quite an amount of buzz around it today because it makes so many things easy that were difficult with virtual machines.Docker containers makes it easy for Developers, Systems Administrators, Architects, Consultants and others to quickly test a piece of software in a container; much quicker than a virtual machine, and using less resources. The average command in Docker 
takes under a second to complete.
Docker is an open source platform for building, deploying, and managing containerized
applications.
<br><br>

## **About docker**
Docker is a software platform for building applications based on containers small and lightweight execution environments that make shared use of the operating system kernel but otherwise run in isolation from one another. While containers have been used in Linux and Unix systems for some time, Docker, an open source project launched in 2013, helped popularize the technology by making it easier than ever for developers to package their software to “build once and run anywhere.”
<br><br>

## **Why use docker?**
Docker enables developers to easily pack, ship, and run any application as a lightweight, portable, self-sufficient container, 
which can run virtually anywhere. Docker containers provide a way to get a grip on software. You can use Docker to wrap up an application in such a way 
that its deployment and runtime issues—how to expose it on a network, how to manage its use of storage and memory and I/O, how to control access permissions—are 
handled outside of the application itself, and in a way that is consistent across all “containerized” apps. You can run your Docker container on any OS-compatible 
host (Linux or Windows) that has the Docker runtime installed.
<br><br>

## **Importance of Docker?**
Docker is so popular today that “Docker” and “containers” are used interchangeably. But the first container-related technologies were available for years, even decades before Docker was released to the public in 2013. 
<br>
Docker enhanced the native Linux containerization capabilities with technologies that enable:
- Improved and seamless portability
- Even lighter weight and more granular updates
- Automated container creation
- Container versioning
- Container reuse
- Shared container libraries
<br><br>

## **Docker tools**
- **DockerFile :** Every Docker container starts with a simple text file containing instructions for how to build the Docker container image. 
- **Docker images :** Docker images contain executable application source code as well as all the tools, libraries, and dependencies that the application code needs to run as a container.
- **Docker containers :** Docker containers are the live, running instances of Docker images. While Docker images are read-only files, containers are live, ephemeral, executable content. 
- **Docker Hub :** Docker Hub is the public repository of Docker images that is the “world’s largest library and community for container images.” It holds over 100,000 container images sourced from commercial software vendors, open-source projects, and individual developers.
- **Docker daemon :** Docker daemon is a service running on your operating system, such as Microsoft Windows or Apple MacOS or iOS. 
- **Docker registry :** A Docker registry is a scalable open-source storage and distribution system for docker images.

## Docker Architecture

![Docker Architecture](https://docs.docker.com/engine/images/architecture.svg "Text to show on mouseover")
- It uses Client-Server Architecture Model.
- The Docker client talks to Docker daemon, which does heavy lifting of building, running, and distributing your Docker containers.
- The Docker client and daemon can run on the same system, or you can connect a Docker client to a remote Docker daemon. 
- The Docker client and daemon communicate using a REST API, over UNIX sockets or a network interface. 
- Another Docker client is Docker Compose, that lets you work with applications consisting of a set of containers.

If you don't know what is Daemon then, understand it as a computer program that runs as a background process and it is ready to perform an operation whenever required.

Let's Understand actual flow of instructions :
- Docker daemon listens to Docker API requests and manages objects.
- Docker Client is the way users interacts with Docker. When you run ```docker``` commands it uses docker API and client can them communicate with more than one Daemon.
- Docker registry stores docker images.


## Tech Stack

- Docker is written in the **Go programming language** and takes advantage of several features of the **Linux kernel** to deliver its functionality.
- Docker uses a technology called namespaces to provide the isolated workspace called the container. When you run a container, Docker creates a set of namespaces for that container.

## **Getting started with Docker Hub and using images from docker hub**
<br>

### **Step-1:** Sign up for a Docker account
**Creating [Docker ID](https://hub.docker.com/signup):** A Docker ID grants you access to Docker Hub repositories and allows you to explore images that are available from the community and verified publishers. You’ll also need a Docker ID to share images on Docker Hub.
<br><img src='https://i.ibb.co/9NhZDVD/image.png' style='width:40%'><br>

### **Step-2:** Create your first repository
**To create a repository:**
1. Sign in to Docker Hub.
2. Click Create a Repository on the Docker Hub welcome page:
3. Name it <your-username>/my-private-repo.
4. Set the visibility to Private.
<br><img src='https://i.ibb.co/Lpw9XrT/image.png' style='width:40%'>

5. Click Create.
<br><img src='https://i.ibb.co/zbTFn4K/image.png' style='width:40%'>

### **Step-3:** Download and install Docker Desktop
1. Download and install [Docker Desktop](https://docs.docker.com/desktop/#download-and-install). If on Linux, download [Docker Engine](https://docs.docker.com/engine/install/).
2. Sign into the Docker Desktop application using the Docker ID you created in Step 1.
<br>

### **Step-4:** Build and push a container image to Docker Hub from your computer
1. Start by creating a Dockerfile to specify your application as shown below:
```
# syntax=docker/dockerfile:1
FROM busybox
CMD echo "Hello world! This is my first Docker image."
```
2. Run ```docker build -t <your_username>/my-private-repo .``` to build your Docker image.
3. Run ```docker run <your_username>/my-private-repo``` to test your Docker image locally.
4. Run ```docker push <your_username>/my-private-repo``` to push your Docker image to Docker Hub. You should see output similar to:
<br><img src='https://docs.docker.com/docker-hub/images/index-terminal.png' style='width:40%'>

5. Your repository in Docker Hub should now display a new ```latest``` tag under Tags
<br><br>

---

# Project Demo

## Installation and Setup

- First of all we are supposed to Install Docker Engine. It is available for all Operating systems. 

But here we will be looking for Linux Platforms (**Ubuntu Focal 20.04** to be more specific). You can find about your OS from official site https://docs.docker.com/engine/install/


Note : Plz know that we are following Ubuntu guide. You must refer official site if you have different Operating System.

---

## Installation Method

You can install Docker Engine in different ways, depending on your needs:

- Most users set up Docker’s repositories and install from them, for ease of installation and upgrade tasks. This is the recommended approach.

- Some users download the DEB package and install it manually and manage upgrades completely manually. This is useful in situations such as installing Docker on air-gapped systems with no access to the internet.

- In testing and development environments, some users choose to use automated convenience scripts to install Docker.

Here We will follow Install using Repository Method !
- Step 1 : Update the apt package index and install packages to allow apt to use a repository over HTTPS


```Bash
$sudo apt-get update
$sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
```

- Step 2 : Add Docker’s official GPG key (Please Key as per your OS)
```Bash
$curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
```

- Step 3 : Use the following command to set up the stable repository.
```Bash 
$echo \
  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

- Step 4 : Use the following command locate your docker engine on your system files.
```Bash
$sudo apt-get install docker.io
```

-Step 5 : Run the following command and check if everything worked well with your installation.

```Bash
sudo docker run hello-world
```

You should expect this as your output :

![image](https://user-images.githubusercontent.com/79367883/134220738-45ed7412-3b16-4216-9b8c-b5db882a13c5.png)


### Let's Build Project.
We will be making a simple python web application running on Docker Compose. We shall use Flask framework and implement hit counter in Redis. It will increment the number of times you the page.

###  Step 1 : Setup

1. Create a directory for project.
```Bash
$mkdir GWOC_OS_Docker
$cd GWOC_OS_Docker
```
2. Create a file ```app.py``` and paste below code in it.

```Python
import time

import redis
from flask import Flask

app = Flask(__name__)
cache = redis.Redis(host='redis', port=6379)

def get_hit_count():
    retries = 5
    while True:
        try:
            return cache.incr('hits')
        except redis.exceptions.ConnectionError as exc:
            if retries == 0:
                raise exc
            retries -= 1
            time.sleep(0.5)

@app.route('/')
def hello():
    count = get_hit_count()
    return 'Welcome to GWOC OpenSource Docker Learning! I have been seen {} times.\nContributed by Harshil-Jani'.format(count)
```

In this example, ```redis``` is the hostname of the redis container on the application’s network. We use the default port for Redis, ```6379```.

3. Create another file called requirements.txt in your project directory and paste this in:
```text
flask
redis
```

### Step 2 : Create a Dockerfile

In this step, you write a Dockerfile that builds a Docker image. The image contains all the dependencies the Python application requires, including Python itself.

In your project directory, create a file named Dockerfile and paste the following:

```Dockerfile
# syntax=docker/dockerfile:1
FROM python:3.7-alpine
WORKDIR /code
ENV FLASK_APP=app.py
ENV FLASK_RUN_HOST=0.0.0.0
RUN apk add --no-cache gcc musl-dev linux-headers
COPY requirements.txt requirements.txt
RUN pip install -r requirements.txt
EXPOSE 5000
COPY . .
CMD ["flask", "run"]
```
This tells Docker to:

- Build an image starting with the Python 3.7 image.
- Set the working directory to /code.
- Set environment variables used by the flask command.
- Install gcc and other dependencies
- Copy requirements.txt and install the Python dependencies.
- Add metadata to the image to describe that the container is listening on port 5000
- Copy the current directory . in the project to the workdir . in the image.
- Set the default command for the container to flask run.

### Step 3 : Define services in a Compose File

Create a file called docker-compose.yml in your project directory and paste the following:

```yml
version: "3.3"
services:
  web:
    build: .
    ports:
      - "5000:5000"
  redis:
    image: "redis:alpine"
```
This Compose file defines two services: web and redis.

### Step 4 : Build and run you app with Compose

1. From your project directory, start up your application by running docker-compose up.

```Bash
$sudo apt instal
$sudo docker-compose up
```
2. Visit your local host at port 5000 from link given in the terminal window
![image](https://user-images.githubusercontent.com/79367883/134241550-2223c10c-981b-4d3e-a967-8ceea9d7c5c1.png)

The Initial Output seems like this : 

![image](https://user-images.githubusercontent.com/79367883/134242109-d694609d-9f95-4ab7-afea-64bac2926683.png)

Every time you refresh the site the number counter increases

![image](https://user-images.githubusercontent.com/79367883/134242637-06e23586-a8b4-4e56-b3d0-1b02983c7f6a.png)

